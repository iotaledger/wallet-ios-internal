name: Release

on:
  push:
    tags:
      - '*'

  workflow_dispatch:

jobs:
  build:
    runs-on: macos-11

    steps:
      - uses: actions/checkout@v2

      - name: Make universal framework
        run: |
          cd binding
          ./make_universal_xcframework.sh
          cd target/universal
          zip -r IOTAWalletInternal.zip IOTAWalletInternal.xcframework
          release_file="IOTAWalletInternal.zip"
          release_body_file="release.md"
          release_md5=`md5 ${release_file}|tail -c 33`
          release_sha1=`openssl sha1 ${release_file}|tail -c 41`
          touch $release_body_file
          echo "### Checksum" >> $release_body_file
          echo "MD5: \`${release_md5}\`" >> $release_body_file
          echo "SHA1: \`${release_sha1}\`" >> $release_body_file
      
      - name: List file sizes
        run: ls -lh
        working-directory: binding/target/universal

      # - name: Create Release
      #   id: create_release
      #   uses: actions/create-release@v1
      #   env:
      #     GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      #   with:
      #     tag_name: ${{ github.ref }}
      #     release_name: IOTAWalletInternal ${{ github.ref }}
      #     draft: false
      #     prerelease: false
      #     body_path: binding/target/universal/release.md
      
      # - name: Upload Release Asset
      #   id: upload-release-asset 
      #   uses: actions/upload-release-asset@v1
      #   env:
      #     GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      #   with:
      #     upload_url: ${{ steps.create_release.outputs.upload_url }}
      #     asset_path: binding/target/universal/IOTAWalletInternal.zip
      #     asset_name: IOTAWalletInternal-${{ github.ref }}.zip
      #     asset_content_type: application/zip
